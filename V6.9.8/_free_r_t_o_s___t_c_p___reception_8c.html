<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FreeRTOS-Plus-TCP: FreeRTOS_TCP_Reception.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FreeRTOS-Plus-TCP<span id="projectnumber">&#160;V4.3.2</span>
   </div>
   <div id="projectbrief">FreeRTOS TCP/IP library</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_free_r_t_o_s___t_c_p___reception_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">FreeRTOS_TCP_Reception.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Module which processes the packet received from a socket for FreeRTOS+TCP.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;FreeRTOS.h&quot;</code><br />
<code>#include &quot;task.h&quot;</code><br />
<code>#include &quot;queue.h&quot;</code><br />
<code>#include &quot;semphr.h&quot;</code><br />
<code>#include &quot;FreeRTOS_IP.h&quot;</code><br />
<code>#include &quot;FreeRTOS_Sockets.h&quot;</code><br />
<code>#include &quot;FreeRTOS_IP_Private.h&quot;</code><br />
<code>#include &quot;FreeRTOS_UDP_IP.h&quot;</code><br />
<code>#include &quot;FreeRTOS_DHCP.h&quot;</code><br />
<code>#include &quot;NetworkInterface.h&quot;</code><br />
<code>#include &quot;NetworkBufferManagement.h&quot;</code><br />
<code>#include &quot;FreeRTOS_TCP_Transmission.h&quot;</code><br />
<code>#include &quot;FreeRTOS_TCP_Reception.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a87834ef749fe4fc672f0bc76575db2d3"><td class="memItemLeft" align="right" valign="top">static int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a87834ef749fe4fc672f0bc76575db2d3">prvSingleStepTCPHeaderOptions</a> (const uint8_t *const pucPtr, size_t uxTotalLength, FreeRTOS_Socket_t *const pxSocket, BaseType_t xHasSYNFlag)</td></tr>
<tr class="memdesc:a87834ef749fe4fc672f0bc76575db2d3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identify and deal with a single TCP header option, advancing the pointer to the header.  <br /></td></tr>
<tr class="separator:a87834ef749fe4fc672f0bc76575db2d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fcd8c12ef21afe4e11a89a31b74404b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a4fcd8c12ef21afe4e11a89a31b74404b">prvReadSackOption</a> (const uint8_t *const pucPtr, size_t uxIndex, FreeRTOS_Socket_t *const pxSocket)</td></tr>
<tr class="memdesc:a4fcd8c12ef21afe4e11a89a31b74404b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Skip past TCP header options when doing Selective ACK, until there are no more options left.  <br /></td></tr>
<tr class="separator:a4fcd8c12ef21afe4e11a89a31b74404b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1224fb3e9921e48932c5211dc3acf4b2"><td class="memItemLeft" align="right" valign="top">BaseType_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a1224fb3e9921e48932c5211dc3acf4b2">prvCheckOptions</a> (FreeRTOS_Socket_t *pxSocket, const NetworkBufferDescriptor_t *pxNetworkBuffer)</td></tr>
<tr class="memdesc:a1224fb3e9921e48932c5211dc3acf4b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the TCP option(s) received, if present.  <br /></td></tr>
<tr class="separator:a1224fb3e9921e48932c5211dc3acf4b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7717f08f62c80726946508abf3192c2c"><td class="memItemLeft" align="right" valign="top">BaseType_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a7717f08f62c80726946508abf3192c2c">prvCheckRxData</a> (const NetworkBufferDescriptor_t *pxNetworkBuffer, uint8_t **ppucRecvData)</td></tr>
<tr class="memdesc:a7717f08f62c80726946508abf3192c2c"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a7717f08f62c80726946508abf3192c2c" title="prvCheckRxData(): called from prvTCPHandleState(). The first thing that will be done is find the TCP ...">prvCheckRxData()</a>: called from <a class="el" href="_free_r_t_o_s___t_c_p___state___handling_8c.html#ab9bdd210a90bd874dfbac809478edc93" title="Check incoming packets for valid data and handle the state of the TCP connection and respond accordin...">prvTCPHandleState()</a>. The first thing that will be done is find the TCP payload data and check the length of this data.  <br /></td></tr>
<tr class="separator:a7717f08f62c80726946508abf3192c2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a487796a6eddaa24e9ece51d661a8b34b"><td class="memItemLeft" align="right" valign="top">BaseType_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a487796a6eddaa24e9ece51d661a8b34b">prvStoreRxData</a> (FreeRTOS_Socket_t *pxSocket, const uint8_t *pucRecvData, NetworkBufferDescriptor_t *pxNetworkBuffer, uint32_t ulReceiveLength)</td></tr>
<tr class="memdesc:a487796a6eddaa24e9ece51d661a8b34b"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a487796a6eddaa24e9ece51d661a8b34b" title="prvStoreRxData(): called from prvTCPHandleState(). The second thing is to do is check if the payload ...">prvStoreRxData()</a>: called from <a class="el" href="_free_r_t_o_s___t_c_p___state___handling_8c.html#ab9bdd210a90bd874dfbac809478edc93" title="Check incoming packets for valid data and handle the state of the TCP connection and respond accordin...">prvTCPHandleState()</a>. The second thing is to do is check if the payload data may be accepted. If so, they will be added to the reception queue.  <br /></td></tr>
<tr class="separator:a487796a6eddaa24e9ece51d661a8b34b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Module which processes the packet received from a socket for FreeRTOS+TCP. </p>
<p>Endianness: in this module all ports and IP addresses are stored in host byte-order, except fields in the IP-packets </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a87834ef749fe4fc672f0bc76575db2d3" name="a87834ef749fe4fc672f0bc76575db2d3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87834ef749fe4fc672f0bc76575db2d3">&#9670;&#160;</a></span>prvSingleStepTCPHeaderOptions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int32_t prvSingleStepTCPHeaderOptions </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *const&#160;</td>
          <td class="paramname"><em>pucPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>uxTotalLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FreeRTOS_Socket_t *const&#160;</td>
          <td class="paramname"><em>pxSocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseType_t&#160;</td>
          <td class="paramname"><em>xHasSYNFlag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Identify and deal with a single TCP header option, advancing the pointer to the header. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pucPtr</td><td>Pointer to the TCP packet options. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uxTotalLength</td><td>Length of the TCP packet options. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pxSocket</td><td>Socket handling the connection. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xHasSYNFlag</td><td>Whether the header has SYN flag or not.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function returns index of the next option if the current option is successfully processed and it is not the end of options whereafter the caller should continue to process more options. If the options have ended, this function will return a zero whereafter the caller should stop parsing options and continue further processing. If the current option has erroneous value, then the function returns a negative value wherein the calling function should not process this packet any further and drop it. </dd></dl>

</div>
</div>
<a id="a4fcd8c12ef21afe4e11a89a31b74404b" name="a4fcd8c12ef21afe4e11a89a31b74404b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fcd8c12ef21afe4e11a89a31b74404b">&#9670;&#160;</a></span>prvReadSackOption()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void prvReadSackOption </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *const&#160;</td>
          <td class="paramname"><em>pucPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>uxIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FreeRTOS_Socket_t *const&#160;</td>
          <td class="paramname"><em>pxSocket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Skip past TCP header options when doing Selective ACK, until there are no more options left. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pucPtr</td><td>Pointer to the TCP packet options. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uxIndex</td><td>Index of options in the TCP packet options. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pxSocket</td><td>Socket handling the TCP connection. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1224fb3e9921e48932c5211dc3acf4b2" name="a1224fb3e9921e48932c5211dc3acf4b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1224fb3e9921e48932c5211dc3acf4b2">&#9670;&#160;</a></span>prvCheckOptions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseType_t prvCheckOptions </td>
          <td>(</td>
          <td class="paramtype">FreeRTOS_Socket_t *&#160;</td>
          <td class="paramname"><em>pxSocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const NetworkBufferDescriptor_t *&#160;</td>
          <td class="paramname"><em>pxNetworkBuffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse the TCP option(s) received, if present. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pxSocket</td><td>The socket handling the connection. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pxNetworkBuffer</td><td>The network buffer containing the TCP packet.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>: If the options are well formed and processed successfully then pdPASS is returned; else a pdFAIL is returned.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>It has already been verified that: ((pxTCPHeader-&gt;ucTCPOffset &amp; 0xf0) &gt; 0x50), meaning that the TP header is longer than the usual 20 (5 x 4) bytes. </dd></dl>

</div>
</div>
<a id="a7717f08f62c80726946508abf3192c2c" name="a7717f08f62c80726946508abf3192c2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7717f08f62c80726946508abf3192c2c">&#9670;&#160;</a></span>prvCheckRxData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseType_t prvCheckRxData </td>
          <td>(</td>
          <td class="paramtype">const NetworkBufferDescriptor_t *&#160;</td>
          <td class="paramname"><em>pxNetworkBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>ppucRecvData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a7717f08f62c80726946508abf3192c2c" title="prvCheckRxData(): called from prvTCPHandleState(). The first thing that will be done is find the TCP ...">prvCheckRxData()</a>: called from <a class="el" href="_free_r_t_o_s___t_c_p___state___handling_8c.html#ab9bdd210a90bd874dfbac809478edc93" title="Check incoming packets for valid data and handle the state of the TCP connection and respond accordin...">prvTCPHandleState()</a>. The first thing that will be done is find the TCP payload data and check the length of this data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pxNetworkBuffer</td><td>The network buffer holding the received data. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ppucRecvData</td><td>It will point to first byte of the TCP payload.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Length of the received buffer. </dd></dl>

</div>
</div>
<a id="a487796a6eddaa24e9ece51d661a8b34b" name="a487796a6eddaa24e9ece51d661a8b34b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a487796a6eddaa24e9ece51d661a8b34b">&#9670;&#160;</a></span>prvStoreRxData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseType_t prvStoreRxData </td>
          <td>(</td>
          <td class="paramtype">FreeRTOS_Socket_t *&#160;</td>
          <td class="paramname"><em>pxSocket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>pucRecvData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NetworkBufferDescriptor_t *&#160;</td>
          <td class="paramname"><em>pxNetworkBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>ulReceiveLength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html#a487796a6eddaa24e9ece51d661a8b34b" title="prvStoreRxData(): called from prvTCPHandleState(). The second thing is to do is check if the payload ...">prvStoreRxData()</a>: called from <a class="el" href="_free_r_t_o_s___t_c_p___state___handling_8c.html#ab9bdd210a90bd874dfbac809478edc93" title="Check incoming packets for valid data and handle the state of the TCP connection and respond accordin...">prvTCPHandleState()</a>. The second thing is to do is check if the payload data may be accepted. If so, they will be added to the reception queue. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pxSocket</td><td>The socket owning the connection. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pucRecvData</td><td>Pointer to received data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pxNetworkBuffer</td><td>The network buffer descriptor. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ulReceiveLength</td><td>The length of the received data.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure of storing data. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="_free_r_t_o_s___t_c_p___reception_8c.html">FreeRTOS_TCP_Reception.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
